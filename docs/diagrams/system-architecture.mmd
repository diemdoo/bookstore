%%{init: {'theme':'base', 'themeVariables': { 'primaryColor':'#6366f1'}}}%%
graph TB
    subgraph "Client Layer"
        Browser[Web Browser]
    end
    
    subgraph "Frontend - React SPA"
        FE[Frontend App<br/>Port 5173]
        FE_UI[UI Components]
        FE_Pages[Pages]
        FE_Context[Contexts<br/>Auth, Cart]
        FE_Service[API Service]
        
        FE --> FE_UI
        FE --> FE_Pages
        FE --> FE_Context
        FE --> FE_Service
    end
    
    subgraph "Backend - Flask API"
        direction TB
        API[Flask API<br/>Port 5000]
        
        subgraph "Routes Layer"
            Routes[Routes<br/>auth, books, cart, orders, admin, categories, banners]
            Routes_Logic[Business Logic<br/>in Routes]
        end
        
        subgraph "Models Layer"
            Models[SQLAlchemy Models<br/>User, Book, Order, Cart, etc.]
        end
        
        subgraph "Utils Layer"
            Utils[Helper Functions<br/>hash_password, decorators, validation]
            Storage_Utils[Storage Utils<br/>Cloudflare R2]
        end
        
        API --> Routes
        Routes --> Routes_Logic
        Routes --> Models
        Routes --> Utils
        Routes --> Storage_Utils
    end
    
    subgraph "Database Layer"
        DB[(PostgreSQL<br/>Port 5432)]
        PGAdmin[pgAdmin 4<br/>Port 5050]
    end
    
    subgraph "Storage Layer"
        R2[Cloudflare R2<br/>Object Storage<br/>cdn.duyne.me]
    end
    
    Browser -->|HTTP/HTTPS| FE
    FE_Service -->|REST API Calls| API
    Models -->|SQL Queries via ORM| DB
    PGAdmin -.->|Manage| DB
    Storage_Utils -->|File Upload| R2
    
    classDef frontend fill:#a5f3fc,stroke:#0891b2,stroke-width:2px
    classDef backend fill:#c7d2fe,stroke:#6366f1,stroke-width:2px
    classDef database fill:#fef08a,stroke:#ca8a04,stroke-width:2px
    classDef storage fill:#fda4af,stroke:#e11d48,stroke-width:2px
    
    class FE,FE_UI,FE_Pages,FE_Context,FE_Service frontend
    class API,Routes,Routes_Logic,Models,Utils,Storage_Utils backend
    class DB,PGAdmin database
    class R2 storage
